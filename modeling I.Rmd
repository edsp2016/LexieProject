---
title: "modeling part I"
author: "Siyang Sun"
date: "April 4, 2016"
output: html_document
---
# Adjusting for ticket price inflation 
http://www.boxofficemojo.com/about/adjuster.htm
```{r}
inf<-read.csv("/Users/mac/Desktop/EDSP\ /inflation.csv",header =T)
df$price<-0
for (i in 2:nrow(inf)){
  df$price[grep(inf$Year[i],df$release_year)]<-inf$Avg..Price[i]    
}
df$price<-gsub("\\$","",df$price)
df$adjusted<-8.7*df$domestic/as.numeric(df$price)
df$adow<-round(8.7*df$ow/as.numeric(df$price),2)
df$adbudget<-round(8.7*df$budget/as.numeric(df$price),2)
df$adjusted<-round(df$adjusted,2)
write.table(df,"/Users/mac/Desktop/EDSP\ /adjusted_data.txt")
```
# 1. Linear regression model 
```{r,echo=FALSE}
da<-df
da$number<-NULL
da$worldwide<-NULL
da$overseas<-NULL
da$title1<-NULL
da$rank<-NULL
da$title<-NULL
da$genre1<-NULL
da$genre2<-NULL  
da$director1<-NULL
da$director2<-NULL
da$star1<-NULL
da$star2<-NULL
da$bb<-NULL
da$domestic<-NULL
da$price<-NULL
da$adjusted<-df$adjusted
da$adow<-NULL
da$adbudget<-NULL
da$rn[which(da$rn==0)]<-NA
da$to_rating[which(da$to_rating==0)]<-NA
danew<-na.omit(da)
```
## Outcome variable: domestic box office (adjusted)
### 1. treating studio genre mpaa per as categorical variable
```{r}
#baseline model
res0<-lm(da$adjusted~da$budget,da)
summary(res0)
#stepwise regression
res1<-lm(da$adjusted~.,da)
summary(res1)
#omitted missing data
## Is there anyway to do not omit data and conduct the stepwise procedure? 
resnew1<-lm(danew$adjusted~.,danew)
summary(resnew1)
library(MASS)
step <- stepAIC(resnew1, direction="backward")
step$anova
resnew1step<-lm(danew$adjusted ~ studio + release_year + genre + mpaa + ow + 
    weeks + rn,danew)
summary(resnew1step)
```
Final model:
resnew1step<-lm(danew$adjusted ~ studio + release_year + genre + mpaa + ow + 
    weeks + rn,danew)
Adjusted R-squared:  0.7988 
### 2. treating studio genre mpaa per as numeric variable
```{r}
da$genre<-as.numeric(da$genre)
da$studio<-as.numeric(da$studio)
da$mpaa<-as.numeric(da$mpaa)
da$per<-as.numeric(da$per)
res2<-lm(da$adjusted~.,da)
summary(res2)
resnew2<-lm(danew$adjusted~.,danew)
summary(resnew2)
step <- stepAIC(resnew2, direction="backward")
step$anova
resnew2step<-lm(danew$adjusted ~ studio + release_year + genre + mpaa + ow + 
    weeks + rn,danew)
summary(resnew2step)
#?Is it a coincidence?
```
exactly the same model, this time R^2 is 0.789.

Try delete theater,opening weekend and weeks (too many NA inside, highly correlated)
```{r}
da$ow<-NULL
da$theater<-NULL
da$weeks<-NULL
danew<-na.omit(da)
###???
lm1<-lm(danew$adjusted~.,danew)
summary(lm1)
```
##2. Outcome variable: openging weekend 
```{r}
res3<-lm(ow~.-adjusted-ow,danew)
summary(res3)
step <- stepAIC(res3, direction="backward")
step$anova
resnew3step<-lm(ow ~ studio + mpaa + theater + weeks + per + budget + rn + sh,danew)
summary(resnew3step)
```
R^2 is 60.5%, not better.

#2.Regression decision Tree
```{r}

```

